#parse("java/default:storyPattern/link/import.vm" )
## multi
#set( $multiLink = $token.getMultiLink() )
#if( $multiLink )
#if ( $multiLink.equals($targetMulti) )
#if ( $multiLink.Type == 3) ##INDEX link
#set( $index = $multiLink.Index)
#else
#set( $index = "1")
#end
#set( $range = "values.indexOf ($targetMulti.SourceObject.ObjectName) + $index" )
#elseif ( $multiLink.equals($sourceMulti) )
#set( $range = "values.indexOf ($sourceMulti.TargetObject.ObjectName)" )
#end
#end
#if ($first)
#if ($link.Name.contains("["))
#set( $sindex = $link.Name.indexOf("[") + 1)
#set( $range = $link.Name.substring($sindex, $link.Name.indexOf("]")) )
#else
#set( $range = "0" )
#end
#end
// create link
#if ( $source.InstanceOf == "Setting" && $source.InstanceOf.DeclaredInPackage == "ecore.EStructuralFeature" && $targetRoleName == "Value")
// primitive type conversation if needed
Object __value;
if ((${sourceName}.getEStructuralFeature() instanceof org.eclipse.emf.ecore.EAttribute)  && !(${sourceName}.get(true) instanceof org.eclipse.emf.ecore.util.FeatureMap)) {
	__value = org.eclipse.emf.ecore.util.EcoreUtil.createFromString((org.eclipse.emf.ecore.EDataType)${sourceName}.getEStructuralFeature().getEType(), ${targetName}.toString());
}
else {
	__value = $targetName;
}
if (${sourceName}.getEStructuralFeature().isMany()) {
#set( $return = $imports.addToImports( "org.eclipse.emf.common.util.EList" ) )
    EList<Object> values = ((EList<Object>)${sourceName}.get(true));
#if( $range)
    int idx = $range;
    if (values.size() <= idx) {
    	if (${sourceName}.get(true) instanceof org.eclipse.emf.ecore.util.FeatureMap) {
    		org.eclipse.emf.ecore.util.FeatureMapUtil.addText((org.eclipse.emf.ecore.util.FeatureMap)${sourceName}.get(true), __value.toString()); 
    	}
    	else {
    		if (__value instanceof String) {
    			values.addAll(Arrays.asList(((String)__value).split("/")));
    		}
    		else {
    			values.add(__value);
    		}
    	}
    }
    else {
    	if (${sourceName}.get(true) instanceof org.eclipse.emf.ecore.util.FeatureMap) {
    		org.eclipse.emf.ecore.util.FeatureMapUtil.addText((org.eclipse.emf.ecore.util.FeatureMap)${sourceName}.get(true), idx, __value.toString()); 
    	}
    	else {
    		if (__value instanceof String) {
    			values.addAll(idx, Arrays.asList(((String)__value).split("/")));
    		}
    		else {
    			values.add(idx, __value);
    		}
    	}
    }
#else
	if (${sourceName}.get(true) instanceof org.eclipse.emf.ecore.util.FeatureMap) {
		org.eclipse.emf.ecore.util.FeatureMapUtil.addText((org.eclipse.emf.ecore.util.FeatureMap)${sourceName}.get(true), __value.toString()); 
	}
	else {
    	if (__value instanceof String) {
    		values.addAll(Arrays.asList(((String)__value).split("/")));
    	}
    	else {
    		values.add(__value);
    	}
	}
#end
}
else {
    ${sourceName}.set(__value);
}
#else
#if ($toOne)
${sourceName}.set$targetRoleName($targetName);
#else
${sourceName}.get$targetRoleName().add($targetName);
#end
#end

